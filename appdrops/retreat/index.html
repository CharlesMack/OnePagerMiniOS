<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>P.O.P.S. Retreat ‚Äî Beaver Creek Breakfast</title>
<style>
  :root {
    --bg1:#e3d9c6; --bg2:#a9b8a4;
    --fg:#2d2a26; --wood:#5a4632; --accent:#d97706;
    --glass:rgba(255,255,255,0.6); --rim:rgba(0,0,0,0.08);
  }
  * { box-sizing:border-box; }
  html,body {
    margin:0; padding:0; height:100%;
    background:linear-gradient(var(--bg1),var(--bg2));
    color:var(--fg); font:500 14px/1.4 "Manrope",system-ui,Segoe UI,Inter;
  }
  header {
    text-align:center; padding:20px 16px;
    font-family:"EB Garamond",serif; font-size:1.6rem;
  }
  main {
    display:grid; gap:16px; padding:16px; max-width:1000px; margin:0 auto;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  }
  section {
    background:var(--glass); backdrop-filter:blur(6px);
    border-radius:14px; padding:16px; box-shadow:0 8px 24px rgba(0,0,0,.12);
    border:1px solid var(--rim);
  }
  h2 { font-family:"EB Garamond",serif; margin:0 0 10px; font-size:1.25rem; }
  textarea,input[type="text"],input[type="time"] {
    width:100%; padding:10px; border:1px solid var(--wood); border-radius:10px; background:rgba(255,255,255,.7);
  }
  .row { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
  button, .btn {
    background:var(--accent); border:none; padding:8px 12px; border-radius:10px; color:#fff; font-weight:700; cursor:pointer;
    box-shadow:0 4px 12px rgba(217,119,6,.25);
  }
  .ghost { background:transparent; color:var(--fg); border:1px solid var(--wood); box-shadow:none; }
  .muted { opacity:.85; }
  audio { width:100%; margin-top:8px; }
  #timerDisplay { font-weight:700; margin-top:8px; }
  #dropZone {
    border:1px dashed var(--wood); border-radius:12px; padding:14px; text-align:center;
    background:rgba(255,255,255,0.45); transition:background .2s ease, transform .1s ease;
  }
  #dropZone.drag { background:rgba(255,255,255,0.7); transform:scale(1.01); }
  .card {
    background:rgba(255,255,255,.6); border:1px solid var(--wood); border-radius:10px; padding:10px;
  }
  .grid { display:grid; gap:10px; }
  .pill { padding:6px 10px; border-radius:999px; border:1px solid var(--wood); background:rgba(255,255,255,.55); cursor:pointer; }
  .stack { display:flex; gap:8px; flex-wrap:wrap; }
</style>
</head>
<body>
<header>üå≤ P.O.P.S. Retreat ‚Äî Beaver Creek Breakfast</header>

<main>
  <!-- Morning Brew -->
  <section id="brew">
    <h2>‚òï Morning Brew</h2>
    <div class="grid">
      <label class="row">Wake‚Äëup time <input type="time" id="wakeup"></label>
      <label>Today‚Äôs Goal <input type="text" id="goal" placeholder="One clear intention"></label>
      <label>Gratitude <input type="text" id="gratitude" placeholder="What are you thankful for?"></label>
      <div class="row">
        <button id="saveBrew">Save Morning Brew</button>
        <button class="ghost" id="clearBrew">Clear</button>
      </div>
    </div>
  </section>

  <!-- Cabin Journal -->
  <section id="journal">
    <h2>üìñ Cabin Journal</h2>
    <textarea id="journalText" rows="8" placeholder="Write freely. Saved offline to your device."></textarea>
    <div class="row" style="margin-top:8px">
      <button id="saveJournal">Save Entry</button>
      <button class="ghost" id="clearJournal">Clear</button>
    </div>
  </section>

  <!-- Naturecast -->
  <section id="naturecast">
    <h2>üå§Ô∏è Naturecast</h2>
    <div id="natureOutput" class="muted">Sunrise/Sunset (approx) for your season. Offline-friendly.</div>
    <div class="row" style="margin-top:8px">
      <button id="calcSun">Calculate for Today</button>
    </div>
  </section>

  <!-- Sound Loops -->
  <section id="sounds">
    <h2>üéµ Sound Loops (Offline‚ÄëFirst)</h2>

    <!-- 1) Bundled local audio (relative paths) -->
    <div class="grid">
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <strong style="font-family:'EB Garamond',serif">Creek (bundled)</strong>
          <small class="muted">./sounds/creek.mp3</small>
        </div>
        <audio id="bundled1" controls loop preload="auto">
          <source src="./sounds/creek.mp3" type="audio/mpeg">
        </audio>
      </div>

      <div class="card">
        <div class="row" style="justify-content:space-between">
          <strong style="font-family:'EB Garamond',serif">Wind Chimes (bundled)</strong>
          <small class="muted">./sounds/chimes.ogg</small>
        </div>
        <audio id="bundled2" controls loop preload="auto">
          <source src="./sounds/chimes.ogg" type="audio/ogg">
        </audio>
      </div>

      <div class="card">
        <div class="row" style="justify-content:space-between">
          <strong style="font-family:'EB Garamond',serif">Birdsong (bundled)</strong>
          <small class="muted">./sounds/birds.wav</small>
        </div>
        <audio id="bundled3" controls loop preload="auto">
          <source src="./sounds/birds.wav" type="audio/wav">
        </audio>
      </div>
    </div>

    <!-- 2) User-provided local files -->
    <div style="margin-top:12px">
      <p class="muted">Drop MP3/WAV/OGG here, or choose files. They stay on your device.</p>
      <div id="dropZone">
        <strong>Drop audio files here</strong><br>
        <small>or</small><br>
        <label for="audioPicker" class="btn" style="display:inline-block;margin-top:6px;cursor:pointer;">Choose files</label>
        <input id="audioPicker" type="file" accept="audio/*" multiple style="display:none">
      </div>
      <div id="soundList" class="grid" style="margin-top:12px"></div>
    </div>

    <!-- 3) WebAudio ambient fallback -->
    <div class="row" style="margin-top:10px">
      <button id="startFallback">Start Creek Fallback</button>
      <button class="ghost" id="stopFallback">Stop Fallback</button>
    </div>
  </section>

  <!-- Mood Presets -->
  <section id="moods">
    <h2>üå≤ Mood Presets</h2>
    <div class="stack">
      <button class="pill" data-mood="focus">Focused</button>
      <button class="pill" data-mood="reflect">Reflective</button>
      <button class="pill" data-mood="rest">Rest Mode</button>
    </div>
  </section>

  <!-- Firelight Timer -->
  <section id="timer">
    <h2>üïØÔ∏è Firelight Timer</h2>
    <div class="row">
      <button id="startTimer">Start 20m Focus</button>
      <button class="ghost" id="stopTimer">Stop</button>
    </div>
    <div id="timerDisplay" class="muted">Not running</div>
  </section>
</main>

<script>
/* =========================
   Storage helpers
========================= */
const O = (id)=>document.getElementById(id);
const LS = {
  get(k, fallback=null){ try{ return JSON.parse(localStorage.getItem(k) || JSON.stringify(fallback)); }catch{ return fallback; } },
  set(k, v){ localStorage.setItem(k, JSON.stringify(v)); },
  del(k){ localStorage.removeItem(k); }
};

/* =========================
   Morning Brew
========================= */
O('saveBrew').onclick = ()=>{
  LS.set('brew', {
    wakeup: O('wakeup').value,
    goal: O('goal').value,
    gratitude: O('gratitude').value
  });
  toast('Morning Brew saved üåÑ');
};
O('clearBrew').onclick = ()=>{
  ['wakeup','goal','gratitude'].forEach(id=>O(id).value='');
  LS.del('brew');
  toast('Cleared');
};
(function loadBrew(){
  const d = LS.get('brew');
  if(!d) return;
  O('wakeup').value = d.wakeup||'';
  O('goal').value = d.goal||'';
  O('gratitude').value = d.gratitude||'';
})();

/* =========================
   Journal
========================= */
O('saveJournal').onclick = ()=>{ LS.set('journal', O('journalText').value); toast('Journal saved üìñ'); };
O('clearJournal').onclick = ()=>{ O('journalText').value=''; LS.del('journal'); toast('Cleared'); };
(function loadJournal(){
  const t = LS.get('journal','');
  if(t) O('journalText').value = t;
})();

/* =========================
   Naturecast (seasonal approx)
========================= */
O('calcSun').onclick = ()=>{
  const month = (new Date()).getMonth()+1;
  let sunrise="07:00", sunset="17:00";
  if(month>=5 && month<=7){ sunrise="05:30"; sunset="20:45"; }
  else if(month>=8 && month<=9){ sunrise="06:30"; sunset="19:30"; }
  O('natureOutput').textContent = `Sunrise: ${sunrise} ‚Ä¢ Sunset: ${sunset}`;
};

/* =========================
   Mood Presets
========================= */
document.querySelectorAll('#moods .pill').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const mode = btn.dataset.mood;
    if(mode==='focus') document.body.style.background='linear-gradient(#dbeafe,#93c5fd)';
    if(mode==='reflect') document.body.style.background='linear-gradient(#fce7f3,#fbcfe8)';
    if(mode==='rest') document.body.style.background='linear-gradient(#fef9c3,#fde68a)';
  });
});

/* =========================
   Timer (20 min)
========================= */
let timerId=null, secondsLeft=0;
const fmt = (s)=>`${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`;
O('startTimer').onclick = ()=>{
  secondsLeft = 20*60;
  tick();
  timerId && clearInterval(timerId);
  timerId = setInterval(tick, 1000);
  function tick(){
    secondsLeft--;
    O('timerDisplay').textContent = fmt(Math.max(0,secondsLeft));
    if(secondsLeft<=0){ clearInterval(timerId); timerId=null; toast("Time's up üî•"); }
  }
};
O('stopTimer').onclick = ()=>{ timerId && clearInterval(timerId); timerId=null; O('timerDisplay').textContent='Not running'; };

/* =========================
   Sounds: user files
========================= */
const dropZone = O('dropZone');
const audioPicker = O('audioPicker');
const soundList = O('soundList');

audioPicker.addEventListener('change', e => handleFiles(e.target.files));
['dragenter','dragover'].forEach(evt => dropZone.addEventListener(evt, e => { e.preventDefault(); dropZone.classList.add('drag'); }));
['dragleave','drop'].forEach(evt => dropZone.addEventListener(evt, e => { e.preventDefault(); dropZone.classList.remove('drag'); }));
dropZone.addEventListener('drop', e => handleFiles(e.dataTransfer.files));

function handleFiles(fileList){
  const files = Array.from(fileList).filter(f => f.type.startsWith('audio/'));
  if(!files.length) return;
  files.forEach(f => addAudioCard(f));
}
function addAudioCard(file){
  const url = URL.createObjectURL(file);
  const card = document.createElement('div');
  card.className='card';
  card.innerHTML = `
    <div class="row" style="justify-content:space-between;align-items:center">
      <strong style="font-family:'EB Garamond',serif">${escapeHtml(file.name)}</strong>
      <small class="muted">${Math.round(file.size/1024)} KB</small>
    </div>
  `;
  const audio = document.createElement('audio');
  audio.controls = true; audio.loop = true; audio.preload='auto'; audio.src = url;
  audio.addEventListener('error', () => {
    const warn = document.createElement('div');
    warn.style.color = '#8b0000';
    warn.textContent = 'Failed to load this audio (check file type).';
    card.appendChild(warn);
  });
  card.appendChild(audio);
  soundList.appendChild(card);
}
function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

/* =========================
   WebAudio creek fallback
========================= */
let audioCtx=null, fallbackNode=null, gainNode=null, filterNode=null;
O('startFallback').onclick = ()=>{
  if(audioCtx) return;
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const bufferSize = 4096;
  const node = audioCtx.createScriptProcessor(bufferSize, 1, 1);
  const st = {b0:0,b1:0,b2:0,b3:0,b4:0,b5:0,b6:0};
  node.onaudioprocess = e=>{
    const out = e.outputBuffer.getChannelData(0);
    for(let i=0;i<out.length;i++){
      const white = Math.random()*2-1;
      // pink-ish noise (creek texture)
      st.b0 = 0.99886*st.b0 + white*0.0555179;
      st.b1 = 0.99332*st.b1 + white*0.0750759;
      st.b2 = 0.96900*st.b2 + white*0.1538520;
      st.b3 = 0.86650*st.b3 + white*0.3104856;
      st.b4 = 0.55000*st.b4 + white*0.5329522;
      st.b5 = -0.7616*st.b5 - white*0.0168980;
      let pink = st.b0+st.b1+st.b2+st.b3+st.b4+st.b5+st.b6 + white*0.5362;
      st.b6 = white*0.115926; // small feed
      out[i] = pink*0.11;
    }
  };
  gainNode = audioCtx.createGain(); gainNode.gain.value = 0.14;
  filterNode = audioCtx.createBiquadFilter(); filterNode.type='lowpass'; filterNode.frequency.value = 1400;
  node.connect(filterNode); filterNode.connect(gainNode); gainNode.connect(audioCtx.destination);
  fallbackNode = node;
  toast('Ambient creek started üéß');
};
O('stopFallback').onclick = ()=>{
  try{
    if(fallbackNode) fallbackNode.disconnect();
    if(filterNode) filterNode.disconnect();
    if(gainNode) gainNode.disconnect();
    if(audioCtx) audioCtx.close();
  }catch(_){}
  fallbackNode=filterNode=gainNode=audioCtx=null;
  toast('Ambient creek stopped');
};

/* =========================
   Tiny toast
========================= */
function toast(msg){
  const t = document.createElement('div');
  t.textContent = msg;
  t.style.position='fixed'; t.style.left='50%'; t.style.top='20px'; t.style.transform='translateX(-50%)';
  t.style.background='rgba(0,0,0,.7)'; t.style.color='#fff'; t.style.padding='8px 12px'; t.style.borderRadius='10px';
  t.style.boxShadow='0 6px 18px rgba(0,0,0,.25)'; t.style.zIndex=9999; t.style.fontWeight='700';
  document.body.appendChild(t);
  setTimeout(()=>{ t.style.transition='opacity .3s'; t.style.opacity='0'; setTimeout(()=>t.remove(),300); }, 1200);
}
</script>

<!-- AppDrop Manifest (inline for catalog indexing) -->
<script type="application/json" id="appdrop-manifest">
{
  "name": "P.O.P.S. Retreat ‚Äî Beaver Creek Breakfast",
  "version": "1.1.0",
  "description": "Rustic sunrise wellness panel with offline audio (bundled + local loader) and WebAudio creek fallback.",
  "tags": ["morning","wellness","offline","retreat"],
  "author": "Computer World Modern Inc."
}
</script>
</body>
</html>
