<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BOOM Levels! üí• Ultimate Audio & Light Show</title>
  <style>
    :root{
      --bg0:#0b0f14; --bg1:#0e1620; --bg2:#121a26; --glass:rgba(255,255,255,.06);
      --txt:#e8eef6; --muted:#a9b4c2; --acc:#7ee787; --acc2:#7aa2f7; --warn:#ffb86b; --danger:#ff6b6b;
      --neon1:#00ffd0; --neon2:#ff00e6; --neon3:#00a2ff; --neon4:#ffed00;
    }
    html,body{height:100%;}
    body{margin:0;background:radial-gradient(1200px 800px at 50% -10%, #162437 0%, var(--bg0) 40%, #070b10 100%);
      color:var(--txt);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;
      overflow:hidden}

    /* Top HUD */
    .hud{position:fixed;inset:0 0 auto 0;display:flex;align-items:center;gap:.5rem;padding:.5rem .75rem;z-index:10;pointer-events:none}
    .chip{pointer-events:auto;display:inline-flex;align-items:center;gap:.5rem;background:var(--glass);backdrop-filter:blur(10px);
      border:1px solid rgba(255,255,255,.08);border-radius:999px;padding:.35rem .75rem;box-shadow:0 4px 20px rgba(0,0,0,.4)}
    .chip .label{font-size:.85rem;color:var(--muted)}
    .chip input[type="range"]{width:140px}
    .btn{pointer-events:auto;background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.12);color:var(--txt);border-radius:.7rem;padding:.5rem .9rem;cursor:pointer;font-weight:600}
    .btn.toggle.active{box-shadow:0 0 20px var(--neon1) inset,0 0 20px var(--neon1);border-color:var(--neon1)}
    .btn.primary{background:linear-gradient(180deg, rgba(49,224,145,.25), rgba(49,224,145,.08));border-color:rgba(49,224,145,.6)}

    /* Left EQ panel */
    .panel{position:fixed;top:0;left:0;height:100vh;width:320px;background:rgba(12,18,26,.82);
      backdrop-filter:blur(16px);border-right:1px solid rgba(255,255,255,.08);transform:translateX(-100%);transition:transform .35s ease;z-index:20}
    .panel.open{transform:translateX(0)}
    .panel header{display:flex;align-items:center;justify-content:space-between;padding:1rem;border-bottom:1px solid rgba(255,255,255,.06)}
    .panel h2{margin:0;font-size:1.05rem;letter-spacing:.02em}
    .group{padding:1rem;border-bottom:1px solid rgba(255,255,255,.06)}
    .group h3{margin:.2rem 0 .8rem;font-size:.9rem;color:var(--muted);text-transform:uppercase;letter-spacing:.1em}
    .row{display:flex;align-items:center;gap:.75rem;margin:.5rem 0}
    .row .label{width:72px;color:var(--muted);font-size:.85rem}
    .row input[type="range"]{flex:1}
    .presets{display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem}
    .preset{background:var(--glass);border:1px solid rgba(255,255,255,.1);border-radius:.6rem;padding:.45rem .5rem;text-align:center;font-size:.85rem;cursor:pointer}
    .preset.active{border-color:var(--acc2);box-shadow:0 0 0 1px var(--acc2) inset}
    .status{display:flex;gap:.5rem;flex-wrap:wrap}
    .tag{font-size:.8rem;padding:.25rem .5rem;border-radius:.5rem;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.05)}

    /* Canvas layer */
    #stage{position:fixed;inset:0;background:radial-gradient(1000px 700px at 50% 10%, rgba(0,102,255,.12), transparent 45%),
      radial-gradient(900px 600px at 50% 90%, rgba(0,255,170,.10), transparent 60%),
      linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.6));}

    /* Bottom bar */
    .bottom{position:fixed;inset:auto 0 0 0;display:flex;justify-content:space-between;align-items:center;gap:.75rem;padding:.6rem .8rem;background:linear-gradient(180deg,transparent,rgba(0,0,0,.45));z-index:12}
    .left, .right{display:flex;gap:.5rem;align-items:center}

    /* Drop zone */
    .drop{position:fixed;inset:auto 12px 80px 12px;border:1px dashed rgba(255,255,255,.25);border-radius:.9rem;padding:.6rem .8rem;color:var(--muted);display:flex;align-items:center;gap:.6rem;background:rgba(0,0,0,.2);z-index:11}
    .drop.drag{border-color:var(--acc2);color:var(--txt);box-shadow:0 0 16px rgba(122,162,247,.5) inset}

    /* Strobe overlay */
    .strobe{position:fixed;inset:0;background:#fff;opacity:0;pointer-events:none;mix-blend-mode:screen;z-index:9}

    /* Tiny helpers */
    input[type="range"]{accent-color:var(--acc2)}
    .kbd{font:600 .8rem ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.18);padding:.1rem .35rem;border-radius:.35rem}
    .hint{position:fixed;top:56px;left:10px;color:var(--muted);font-size:.85rem;z-index:10}
  </style>
</head>
<body>
  <canvas id="stage"></canvas>
  <div class="strobe" id="strobe"></div>

  <!-- HUD -->
  <div class="hud">
    <div class="chip"><span class="label">Volume</span><input id="vol" type="range" min="0" max="100" value="80"/></div>
    <div class="chip"><span class="label">Balance</span><input id="bal" type="range" min="-100" max="100" value="0"/></div>
    <button class="btn toggle" id="bassBtn">üî• Bass Boost</button>
    <div class="chip"><span class="label">Lasers</span><input id="laser" type="range" min="0" max="100" value="70"/></div>
    <div class="chip"><span class="label">Strobe</span><input id="strobeAmt" type="range" min="0" max="100" value="0"/></div>
    <div class="chip"><span class="label">Speed</span><input id="strobeSpd" type="range" min="0" max="100" value="40"/></div>
    <button class="btn" id="togglePanel">üéöÔ∏è EQ (E)</button>
  </div>
  <div class="hint">Shortcuts: <span class="kbd">Space</span> Play/Pause ‚Ä¢ <span class="kbd">E</span> EQ Panel ‚Ä¢ <span class="kbd">B</span> Bass Boost ‚Ä¢ <span class="kbd">‚Üë/‚Üì</span> Volume</div>

  <!-- Bottom controls -->
  <div class="bottom">
    <div class="left">
      <button class="btn primary" id="play">‚ñ∂Ô∏è Play/Pause</button>
      <label class="btn" for="file">üìÅ Open Audio</label>
      <input id="file" type="file" accept="audio/*" hidden>
      <button class="btn" id="captureTab">üñ•Ô∏è Capture Tab Audio</button>
      <button class="btn" id="mic">üé§ Microphone</button>
    </div>
    <div class="right">
      <span id="now">00:00</span> / <span id="dur">00:00</span>
    </div>
  </div>

  <!-- Drop zone -->
  <div class="drop" id="drop">Drop audio files here‚Ä¶ (MP3/WAV/OGG)</div>

  <!-- EQ Panel -->
  <aside class="panel" id="panel">
    <header>
      <h2>Professional EQ & FX</h2>
      <button class="btn" id="closePanel">Close</button>
    </header>
    <div class="group">
      <h3>Presets</h3>
      <div class="presets" id="presets"></div>
      <div class="status" id="status"></div>
    </div>

    <div class="group">
      <h3>3‚ÄëBand EQ (¬±12 dB)</h3>
      <div class="row"><div class="label">Bass</div><input id="bass" type="range" min="-12" max="12" step="0.1" value="0"><div id="bassVal">0 dB</div></div>
      <div class="row"><div class="label">Mid</div><input id="mid" type="range" min="-12" max="12" step="0.1" value="0"><div id="midVal">0 dB</div></div>
      <div class="row"><div class="label">Treble</div><input id="treble" type="range" min="-12" max="12" step="0.1" value="0"><div id="trebleVal">0 dB</div></div>
      <div class="row"><div class="label">Bass Boost</div><button class="btn toggle" id="bassBoost2">+8 dB</button></div>
    </div>

    <div class="group">
      <h3>Light Show</h3>
      <div class="row"><div class="label">Lasers</div><input id="laser2" type="range" min="0" max="100" value="70"></div>
      <div class="row"><div class="label">Strobe Amt</div><input id="strobe2" type="range" min="0" max="100" value="0"></div>
      <div class="row"><div class="label">Strobe Spd</div><input id="strobe2spd" type="range" min="0" max="100" value="40"></div>
    </div>

    <div class="group">
      <h3>Info</h3>
      <div style="font-size:.9rem;color:var(--muted)">
        Audio Chain: <br>
        <strong>Input ‚Üí Bass (low‚Äëshelf) ‚Üí Mid (peaking) ‚Üí Treble (high‚Äëshelf) ‚Üí Volume ‚Üí Balance ‚Üí Analyser ‚Üí Output</strong>
      </div>
    </div>
  </aside>

  <!-- Hidden media element -->
  <audio id="player" crossorigin="anonymous"></audio>

  <script>
    // ====== Utility ======
    const $ = sel => document.querySelector(sel);
    const clamp = (n,min,max)=>Math.max(min,Math.min(max,n));
    const lerp=(a,b,t)=>a+(b-a)*t;
    const fmtTime = s=>{s=Math.floor(s||0);const m=String(Math.floor(s/60)).padStart(2,'0');const ss=String(s%60).padStart(2,'0');return `${m}:${ss}`};

    // ====== Audio Setup ======
    const audioEl = $('#player');
    let ctx, srcNode, analyser, gainNode, panNode, bassFilter, midFilter, trebleFilter;
    let streamMode = false; // if audio comes from MediaStream

    const state = {
      volume: .8,
      balance: 0,
      bass: 0, mid: 0, treble: 0,
      bassBoost: false,
      lasers: .7,
      strobeAmt: 0,
      strobeSpd: .4,
      preset: 'Flat'
    };

    const PRESETS = [
      {name:'Flat', bass:0, mid:0, treble:0},
      {name:'Rock', bass:4, mid:2, treble:4},
      {name:'Pop', bass:3, mid:-1, treble:3},
      {name:'Jazz', bass:1.5, mid:2.5, treble:2},
      {name:'Classical', bass:-1, mid:2, treble:4},
      {name:'Electronic', bass:5, mid:0, treble:5},
    ];

    function ensureAudio(){
      if(!ctx){
        ctx = new (window.AudioContext || window.webkitAudioContext)();
        bassFilter = ctx.createBiquadFilter(); bassFilter.type='lowshelf'; bassFilter.frequency.value=180;
        midFilter = ctx.createBiquadFilter(); midFilter.type='peaking'; midFilter.frequency.value=1000; midFilter.Q.value=0.9;
        trebleFilter = ctx.createBiquadFilter(); trebleFilter.type='highshelf'; trebleFilter.frequency.value=4200;
        gainNode = ctx.createGain();
        panNode = ctx.createStereoPanner();
        analyser = ctx.createAnalyser(); analyser.fftSize=2048; analyser.smoothingTimeConstant=0.85;
      }
    }

    function connectChain(newSource){
      if(srcNode){try{srcNode.disconnect();}catch{}}
      srcNode = newSource;
      srcNode.connect(bassFilter);
      bassFilter.connect(midFilter);
      midFilter.connect(trebleFilter);
      trebleFilter.connect(gainNode);
      gainNode.connect(panNode);
      panNode.connect(analyser);
      analyser.connect(ctx.destination);
    }

    function useMediaElement(){
      ensureAudio();
      streamMode = false;
      const node = ctx.createMediaElementSource(audioEl);
      connectChain(node);
    }

    async function useMediaStream(stream){
      ensureAudio();
      streamMode = true;
      const node = ctx.createMediaStreamSource(stream);
      connectChain(node);
      if(audioEl.srcObject){audioEl.srcObject=null}
    }

    function applyEQ(){
      // base EQ gains
      const bassGain = state.bass + (state.bassBoost ? 8 : 0);
      bassFilter.gain.value = clamp(bassGain,-12,12);
      midFilter.gain.value = clamp(state.mid,-12,12);
      trebleFilter.gain.value = clamp(state.treble,-12,12);
      gainNode.gain.setTargetAtTime(state.volume, ctx.currentTime, 0.01);
      panNode.pan.setTargetAtTime(state.balance, ctx.currentTime, 0.01);
      updateStatus();
    }

    function setPreset(p){
      state.bass = p.bass; state.mid = p.mid; state.treble = p.treble; state.preset = p.name;
      $('#bass').value=p.bass; $('#mid').value=p.mid; $('#treble').value=p.treble;
      updateReadouts(); applyEQ(); highlightPreset();
    }

    function highlightPreset(){
      document.querySelectorAll('.preset').forEach(btn=>{
        btn.classList.toggle('active', btn.dataset.name===state.preset);
      })
    }

    function updateReadouts(){
      $('#bassVal').textContent = `${Number(state.bass).toFixed(1)} dB`;
      $('#midVal').textContent = `${Number(state.mid).toFixed(1)} dB`;
      $('#trebleVal').textContent = `${Number(state.treble).toFixed(1)} dB`;
    }

    function updateStatus(){
      const stat = $('#status');
      stat.innerHTML = '';
      const tags = [
        `Preset: ${state.preset}`,
        `Bass ${state.bass + (state.bassBoost?8:0)} dB`,
        `Mid ${state.mid} dB`,
        `Treble ${state.treble} dB`,
        `Vol ${(state.volume*100)|0}%`,
        `Bal ${Math.round(state.balance*100)}`
      ];
      tags.forEach(t=>{
        const el=document.createElement('div'); el.className='tag'; el.textContent=t; stat.appendChild(el);
      })
    }

    // ====== UI Wiring ======
    function bindUI(){
      // Presets
      const wrap = $('#presets');
      PRESETS.forEach(p=>{
        const b=document.createElement('button'); b.className='preset'; b.textContent=p.name; b.dataset.name=p.name; b.onclick=()=>setPreset(p); wrap.appendChild(b);
      });
      highlightPreset();

      // Sliders
      $('#vol').addEventListener('input',e=>{state.volume=e.target.value/100; applyEQ()});
      $('#bal').addEventListener('input',e=>{state.balance=e.target.value/100; applyEQ()});
      const sync = (a,b)=>{a.addEventListener('input',e=>{b.value=e.target.value; b.dispatchEvent(new Event('input'))}); b.addEventListener('input',e=>{a.value=e.target.value})}
      sync($('#laser'), $('#laser2')); sync($('#strobeAmt'), $('#strobe2')); sync($('#strobeSpd'), $('#strobe2spd'));
      $('#laser').addEventListener('input', e=> state.lasers = e.target.value/100);
      $('#strobeAmt').addEventListener('input', e=> state.strobeAmt = e.target.value/100);
      $('#strobeSpd').addEventListener('input', e=> state.strobeSpd = e.target.value/100);

      // EQ sliders
      $('#bass').addEventListener('input', e=>{state.bass=parseFloat(e.target.value); updateReadouts(); applyEQ()});
      $('#mid').addEventListener('input', e=>{state.mid=parseFloat(e.target.value); updateReadouts(); applyEQ()});
      $('#treble').addEventListener('input', e=>{state.treble=parseFloat(e.target.value); updateReadouts(); applyEQ()});

      // Bass boost buttons
      function setBassBoost(on){ state.bassBoost=!!on; applyEQ(); [$('#bassBtn'),$('#bassBoost2')].forEach(b=>b.classList.toggle('active',on)); }
      $('#bassBtn').onclick=()=>setBassBoost(!state.bassBoost);
      $('#bassBoost2').onclick=()=>setBassBoost(!state.bassBoost);

      // Panel
      const panel=$('#panel');
      const toggle=()=>panel.classList.toggle('open');
      $('#togglePanel').onclick=toggle; $('#closePanel').onclick=toggle;

      // Transport
      $('#play').onclick=async()=>{
        ensureAudio(); if(ctx.state==='suspended'){await ctx.resume()}
        if(!streamMode){ if(audioEl.paused) audioEl.play(); else audioEl.pause(); }
      };

      // File open
      $('#file').onchange = e=>{
        const f=e.target.files[0]; if(!f) return;
        const url=URL.createObjectURL(f);
        useMediaElement(); audioEl.src=url; audioEl.play();
      };

      // Drag/drop
      const dz=$('#drop');
      ;['dragenter','dragover'].forEach(ev=>dz.addEventListener(ev,e=>{e.preventDefault();dz.classList.add('drag')}));
      ;['dragleave','drop'].forEach(ev=>dz.addEventListener(ev,e=>{e.preventDefault();dz.classList.remove('drag')}));
      dz.addEventListener('drop', e=>{const f=e.dataTransfer.files[0]; if(f){const url=URL.createObjectURL(f); useMediaElement(); audioEl.src=url; audioEl.play();}})

      // Capture Tab Audio
      $('#captureTab').onclick=async()=>{
        try{
          const stream = await navigator.mediaDevices.getDisplayMedia({audio:true, video:true});
          await useMediaStream(stream);
          // Optional: hide the captured video track
          stream.getVideoTracks().forEach(t=>t.stop());
        }catch(err){console.warn('Capture canceled or failed',err)}
      };

      // Microphone
      $('#mic').onclick=async()=>{
        try{
          const stream = await navigator.mediaDevices.getUserMedia({audio:true});
          await useMediaStream(stream);
        }catch(err){console.warn('Mic denied',err)}
      };

      // Time update
      audioEl.ontimeupdate = ()=>{ $('#now').textContent=fmtTime(audioEl.currentTime); $('#dur').textContent=fmtTime(audioEl.duration)};
      audioEl.onloadedmetadata = ()=>{ $('#dur').textContent=fmtTime(audioEl.duration)};

      // Keys
      window.addEventListener('keydown', async (e)=>{
        if(['INPUT','TEXTAREA'].includes(e.target.tagName)) return;
        if(e.code==='Space'){ e.preventDefault(); $('#play').click(); }
        if(e.code==='KeyE'){ e.preventDefault(); $('#togglePanel').click(); }
        if(e.code==='KeyB'){ e.preventDefault(); $('#bassBtn').click(); }
        if(e.code==='ArrowUp'){ e.preventDefault(); const v=clamp(Number($('#vol').value)+5,0,100); $('#vol').value=v; $('#vol').dispatchEvent(new Event('input')) }
        if(e.code==='ArrowDown'){ e.preventDefault(); const v=clamp(Number($('#vol').value)-5,0,100); $('#vol').value=v; $('#vol').dispatchEvent(new Event('input')) }
      });
    }

    // ====== Visualization ======
    const canvas = $('#stage'); const ctx2d = canvas.getContext('2d');
    let W=innerWidth, H=innerHeight; canvas.width=W; canvas.height=H;
    addEventListener('resize',()=>{W=innerWidth;H=innerHeight;canvas.width=W;canvas.height=H});

    const FFT = 1024; // lightweight for perf
    const freqData = new Uint8Array(FFT);

    // Particles for pyro
    const particles=[];
    function spawnPyro(x,y,amt){
      for(let i=0;i<amt;i++){
        const a=Math.random()*Math.PI*2; const s=2+Math.random()*6;
        particles.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:1,size:1+Math.random()*3});
      }
    }

    let t=0, bassEnv=0, midEnv=0, trebEnv=0, volEnv=0, beatTimer=0;

    function sampleBands(){
      if(!analyser){return}
      analyser.fftSize=FFT*2; analyser.getByteFrequencyData(freqData);
      const sr = ctx.sampleRate || 44100;
      const nyq = sr/2; const binHz = nyq / (freqData.length);
      function band(min,max){
        const i0=Math.max(0, Math.floor(min/binHz));
        const i1=Math.min(freqData.length-1, Math.floor(max/binHz));
        let s=0,c=0; for(let i=i0;i<=i1;i++){s+=freqData[i];c++} return (s/(c||1))/255;
      }
      const bass = band(20,200);
      const mid = band(200,2000);
      const treb = band(2000,16000);
      const vol = band(20,16000);
      const smooth=.2;
      bassEnv = lerp(bassEnv, bass, smooth);
      midEnv = lerp(midEnv, mid, smooth);
      trebEnv = lerp(trebEnv, treb, smooth);
      volEnv = lerp(volEnv, vol, smooth);
    }

    function drawBackground(){
      // Dance floor
      const rows=8, cols=14; const h=H*0.28; const y0=H-h;
      const bw=W/cols, bh=h/rows;
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          const cx=c+.5, cy=r+.5; const px=c*bw, py=y0+r*bh; const pulse=Math.sin(t*state.strobeSpd*6 + (c+r)*0.3)*0.5+0.5;
          const beat= Math.pow(clamp(bassEnv*2,0,1),1.5);
          const hue = 180 + (c*10 + r*8 + t*20)%180;
          const alpha = .22 + .5*pulse*beat;
          ctx2d.fillStyle=`hsla(${hue},90%,50%,${alpha})`;
          ctx2d.fillRect(px,py,bw-2,bh-2);
        }
      }

      // EQ bars (top)
      const bars=64; const bw2=W/bars;
      for(let i=0;i<bars;i++){
        const idx = Math.floor(i*(freqData.length-1)/bars);
        const v = (freqData[idx]||0)/255;
        const h = v*H*0.25;
        ctx2d.fillStyle=`rgba(126,162,247,${0.15+v*0.8})`;
        ctx2d.fillRect(i*bw2+1, H*0.02 + (H*0.25-h), bw2-2, h);
      }
    }

    function drawLasers(){
      const beams=8; const centerY=H*0.35; const intensity = clamp(trebEnv*1.5*state.lasers, 0, 1);
      ctx2d.save(); ctx2d.globalCompositeOperation='screen';
      for(let i=0;i<beams;i++){
        const x = (i+0.5)/beams * W; const y = centerY + Math.sin(t*1.5 + i)*H*0.05;
        const w = 2 + 8*intensity;
        const grad = ctx2d.createLinearGradient(x,0,x,H);
        grad.addColorStop(0,`rgba(0,255,200,${0.0})`);
        grad.addColorStop(.5,`rgba(0,255,200,${0.35+intensity*0.5})`);
        grad.addColorStop(1,`rgba(255,0,240,${0.0})`);
        ctx2d.fillStyle=grad;
        ctx2d.fillRect(x-w/2,0,w,H);
      }
      ctx2d.restore();
    }

    function drawPyro(){
      // Trigger on bass peaks
      const threshold = 0.6;
      if(bassEnv > threshold && beatTimer<=0){
        const extra = state.bassBoost ? 30 : 0;
        spawnPyro(Math.random()*W, H*0.6 + Math.random()*H*0.35, 20+extra);
        beatTimer = 0.12; // seconds
      }
      beatTimer -= 1/60;

      ctx2d.save(); ctx2d.globalCompositeOperation='screen';
      for(let i=particles.length-1;i>=0;i--){
        const p=particles[i]; p.x+=p.vx; p.y+=p.vy; p.vy+=0.06; p.life-=0.02;
        if(p.life<=0){particles.splice(i,1);continue}
        const a=p.life*0.8; const r=p.size*(1.2-p.life);
        const grad=ctx2d.createRadialGradient(p.x,p.y,0,p.x,p.y,r*6);
        grad.addColorStop(0,`rgba(255,220,120,${a})`);
        grad.addColorStop(1,`rgba(255,0,80,0)`);
        ctx2d.fillStyle=grad; ctx2d.beginPath(); ctx2d.arc(p.x,p.y,r,0,Math.PI*2); ctx2d.fill();
      }
      ctx2d.restore();
    }

    function drawStrobe(){
      const el=$('#strobe');
      const amt = state.strobeAmt * clamp(volEnv*1.5,0,1);
      const spd = 2 + state.strobeSpd*18; // Hz-ish
      const flash = (Math.sin(t*spd*6.283)+1)/2; // 0..1
      el.style.opacity = (amt * flash).toFixed(3);
    }

    function loop(){
      requestAnimationFrame(loop); t += 1/60;
      ctx2d.clearRect(0,0,W,H);
      if(analyser){sampleBands()}
      drawBackground();
      drawLasers();
      drawPyro();
      drawStrobe();
    }

    // ====== Boot ======
    (function init(){
      bindUI(); ensureAudio(); useMediaElement(); applyEQ(); updateReadouts(); updateStatus(); loop();
      // Autoplay policy: wait for first user gesture
      document.body.addEventListener('click', ()=>{ if(ctx && ctx.state==='suspended') ctx.resume(); }, {once:true});
    })();
  </script>
</body>
</html>
